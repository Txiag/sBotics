<!DOCTYPE html>
<html>

<head>
    <!-- Metas Tag -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Pagina info  -->
    <title>BlockEduc</title>
    <link rel="shortcut icon" href="./src/img/favicon.png" type="image/png" />
    <link rel="apple-touch-icon" href="./src/img/favicon.png" />

    <!-- CSS -->
    <link rel="stylesheet" href="./src/css/load.css?version=5">
    <link rel="stylesheet" href="./src/css/progressBar.css?version=5">
    <link rel="stylesheet" href="./src/font-awesome/css/font-awesome.min.css">

    <!-- Script -->
    <script src="./src/sweet/sweetalert2.all.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
</head>

<body>
    <button class="FechaBtn" id="FechaBtn" onclick="close()"><i class="fa fa-times IconeText" aria-hidden="true"></i></button>
    <div class="content">
        <div class="aling">
            <div clas="direita">
                <img id="imgSbotics" class="imgSbotics" src="./src/img/sono.png" alt="sBotics">
            </div>
            <div class="esquerda">
                <p id="txt_status"></p>
                <p id="txt_processo"></p>
                <progress style="display: none;" id="progresso" max="100" value="0" class="node-jsSuccess"></progress>
            </div>
        </div>
    </div>
</body>

<script>
    progressBar(10)
    var i = 0;
    var width = 1;
    var ultimaclass = "node-jsSuccess";

    function trocaClasse(elemento, antiga, nova) {
        elemento.classList.remove(antiga);
        elemento.classList.add(nova);
    }

    function progressBar(num, color, colorStatus, status, processoText) {
        if (i == 0) {
            i = 1;
            var elem = document.getElementById("progresso");
            var id = setInterval(frame, 5);
            elem.style.display = "block";

            function frame() {
                switch (color) {
                    case 'success':
                        document.getElementById("txt_status").style.color = "#34C749";
                        document.getElementById("txt_status").innerText = status;
                        document.getElementById("txt_processo").innerText = processoText;
                        document.getElementById('imgSbotics').src = './src/img/ripe.png';
                        trocaClasse(elem, ultimaclass, 'node-jsSuccess');
                        ultimaclass = 'node-jsSuccess';
                        break;

                    case 'warning':
                        document.getElementById("txt_status").style.color = "#FDBC40";
                        document.getElementById("txt_status").innerText = status;
                        document.getElementById("txt_processo").innerText = processoText;
                        document.getElementById('imgSbotics').src = './src/img/pensativo.png';
                        trocaClasse(elem, ultimaclass, 'node-jsWarning');
                        ultimaclass = 'node-jsWarning';
                        break;

                    case 'error':
                        document.getElementById("txt_status").style.color = "#FC615D";
                        document.getElementById("txt_status").innerText = status;
                        document.getElementById("txt_processo").innerText = processoText;
                        document.getElementById('imgSbotics').src = './src/img/choro.png';
                        trocaClasse(elem, ultimaclass, 'node-jsError');
                        ultimaclass = 'node-jsError';
                        break;

                    case 'fatalError':
                        document.getElementById("txt_status").style.color = "#FC615D";
                        document.getElementById("txt_status").innerText = status;
                        document.getElementById("txt_processo").innerText = processoText;
                        document.getElementById('imgSbotics').src = './src/img/choro.png';
                        document.getElementById('FechaBtn').style.display = "block";
                        trocaClasse(elem, ultimaclass, 'node-jsError');
                        ultimaclass = 'node-jsError';
                        break;

                    case 'info':
                        document.getElementById("txt_status").style.color = "white";
                        document.getElementById("txt_status").innerText = status;
                        document.getElementById("txt_processo").innerText = processoText;
                        document.getElementById('imgSbotics').src = './src/img/info.png';
                        trocaClasse(elem, ultimaclass, 'node-jsInfo');
                        ultimaclass = 'node-jsInfo';
                        break;

                    case 'sBotics':
                        document.getElementById("txt_status").style.color = "#2FA9C2";
                        document.getElementById("txt_status").innerText = status;
                        document.getElementById("txt_processo").innerText = processoText;
                        document.getElementById('imgSbotics').src = './src/img/feliz.png';
                        trocaClasse(elem, ultimaclass, 'node-jssBotics');
                        ultimaclass = 'node-jssBotics';
                        break;
                }
                switch (colorStatus) {
                    case 'success':
                        document.getElementById("txt_processo").style.color = "#34C749";
                        break;

                    case 'warning':
                        document.getElementById("txt_processo").style.color = "#FDBC40";
                        break;

                    case 'error':
                        document.getElementById("txt_processo").style.color = "#FC615D";
                        break;

                    case 'info':
                        document.getElementById("txt_processo").style.color = "white";
                        break;

                    case 'sBotics':
                        document.getElementById("txt_processo").style.color = "#2FA9C2";
                        break;
                }
                if (width >= num) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width++;
                    elem.value = width;
                }
            }
        }
        return;
    }
    progressBar(10, 'sBotics', 'info', 'sBotics', 'BlockEduc');

    setTimeout(function() {
        progressBar(25, 'warning', 'info', 'sBotics', 'Verificando versão...');

        setTimeout(function() {
            progressBar(40, 'success', 'info', 'SUCESSO', 'Versão: 1.0.0 - Atualizado.');

            setTimeout(function() {
                progressBar(50, 'warning', 'info', 'sBotics', 'Localizando sBotics...');

                setTimeout(function() {

                    var Direct = $(location).attr('pathname');
                    console.log("Diretorio: " + Direct);
                    readTextFile("file:///C:/wamp64/www/blockeduc/texte.sBoticsR");

                    function readTextFile(file) {
                        var rawFile = new XMLHttpRequest();
                        rawFile.open("GET", file, true);
                        rawFile.onreadystatechange = function() {
                            if (rawFile.readyState === 4) {
                                if (rawFile.status === 200 || rawFile.status == 0) {
                                    var allText = rawFile.responseText;

                                    if (allText.substr(1, 1) == "-") {
                                        setTimeout(function() {
                                            progressBar(60, 'success', 'info', 'SUCESSO', 'sBotics localizado.');
                                            setTimeout(function() {
                                                progressBar(100, 'success', 'info', 'sBotics', 'Abrindo...');
                                                setTimeout(function() {
                                                    openEditor();
                                                }, 400);
                                            }, 400);
                                        }, 400);
                                    } else {
                                        setTimeout(function() {
                                            progressBar(100, 'fatalError', 'info', 'ERRO', 'sBotics não localizado.');

                                        }, 400);
                                    }
                                }
                            }
                        }
                        rawFile.onerror = function() {
                            setTimeout(function() {
                                progressBar(100, 'fatalError', 'info', 'ERROR', 'Ocorreu um erro ao verificar o sBotics.');
                            }, 400);
                        }
                        rawFile.send(null);
                    }
                }, 400);

            }, 400);

        }, 400);

    }, 400);


    function openEditor() {
        const app = require('electron').remote.app;
        const remote = require('electron').remote;

        var windowManager = remote.require('electron-window-manager');

        var homeWindow = windowManager.createNew('home', 'BlockEduc', '/index.html', false, {
            'width': 1280,
            'height': 720,
            'showDevTools': false,
            'DevTools': true,
            'menu': null,
            'maximizable': true,
            'resizable': true,
            // 'transparent': true,
            // 'frame': false
        });

        homeWindow.open();
        windowManager.close('load');
    }

    function close() {
        window.close();
    }
</script>

</html>